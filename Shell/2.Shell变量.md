# Shell变量

## 一、变量的定义与释放

```bash
#bash中变量的默认类型都是字符串型，即便输入的是数字也是按照字符串型进行存储
a=12
a="helloworld"
a=helloworld
#``命令替换符：将命令的结果作为变量值赋予变量
a=`pwd`
```

实际的变量命名最好按照驼峰式命名。

虽然bash中变量的默认类型是字符串型，数字在需要进行数字计算的时候还是可以使用`$[]`,`let`等来进行计算，最好还是使用`$[]`，因为用变量的时候是需要加上$的，操作统一。

变量的释放使用unset命令。

```bash
unset a
#a可以是数组，字符串等变量，也可以是数组中的一个元素
```



## 二、变量的类型

### 1.用户自定义变量(本地变量)

用户自定义的变量，包括保存在`.bashrc,.xprofile`等文件中的只有本用户可以使用用户的**私有变量**、**脚本中的变量**，及在终端中**临时定义的变量。**只在当前shell中生效。

### 2.全局变量(环境变量)

全局变量有与系统操作环境相关的环境变量，以及在`/etc/bashrc`等文件中定义的变量，在所有shell中都会生效。

### 3.位置参数变量

**位置参数变量是用来向脚本中传递参数或数据**，名称固定。

| 符号    |                             说明                             |
| ------- | :----------------------------------------------------------: |
| `$0`    |                         脚本文件名称                         |
| `$1-$9` |             向脚本传递的参数，`$1`表示第一个参数             |
| `$#`    |         向脚本传递的参数的个数(#通常代表个数，长度)          |
| `$*`    | 向脚本传递的所有参数,保存在字符串中，参数之间还是以空格作为间隔 |
| `$@`    | 向脚本传递的所有参数，保存在字符串中，参数之间还是以空格作为间隔 |

### 4.状态变量

Shell中保存指令与进程状态信息的变量。

| 符号 | 说明                                              |
| ---- | ------------------------------------------------- |
| `$?` | 判断上一条指令是否成功执行，0为成功，非零为不成功 |
| `$$` | 当前进程的PID                                     |
| `$!` | 上一个指令的PID                                   |

**注意：**==位置变量和状态变量中的第一个$代表的是取值运算符。==



## 三、变量展开(Shell Parameter Expansion)

### 1.根据变量定义情况展开(冒号表达式)

| 表达式                    | 说明                                                         | 用途                                               |
| ------------------------- | :----------------------------------------------------------- | :------------------------------------------------- |
| `a=${parameter:-${word}}` | 若parameter定义，则返回parameter值;否则返回word的值，后面一定得是${word}或者具体的值，parameter不作赋值操作 | 如果变量未定义，则返回默认值。                     |
| `a=${parameter:=${word}}` | 若parameter定义，则返回parameter值;否则返回word的值，后面一定得是${word}或者具体的值，parameter被赋值为word | 如果变量未定义，则设置变量为默认值，并返回默认值。 |
| `a=${parameter:?${word}}` | 若parameter定义，则返回parameter值;否则退出当前命令或者脚本  | 捕捉由于变量未定义所导致的错误。                   |
| `a=${parameter:+${word}}` | 若parameter定义，则返回word;否则返回NULL                     | 测试变量的存在。                                   |

```bash
a=${parameter:+1}
#这个就是测试变量是否存在，存在就返回1
```



### 2.字符串展开

#### (1)字符串长度信息

| 表达式          | 说明             |
| --------------- | ---------------- |
| `${#parameter}` | 获得字符串的长度 |

#### (2)字符串截取

| 表达式                       | 说明                             |
| ---------------------------- | -------------------------------- |
| `${parameter:offset}`        | 从第offset字符开始截取           |
| `${parameter:offset:length}` | 从第offset字符开始截取length长度 |

#### (3) 删除匹配

| 表达式                  | 说明                     |
| ----------------------- | ------------------------ |
| `${parameter#pattern}`  | 从头删除==**最短匹配**== |
| `${parameter##pattern}` | 从头删除==**最长匹配**== |
| `${parameter%pattern}`  | 从尾删除最短匹配         |
| `${parameter%%pattern}` | 从尾删除最长匹配         |

在字符串匹配删除时，#代表从头开始匹配，%代表从尾开始删除匹配，单个#或者%表示删除最短匹配，##或者%%表示删除最长匹配。

#### (4)替换匹配

| 表达式                         | 说明             |
| ------------------------------ | ---------------- |
| `${parameter/pattern/string}`  | 第一个匹配被替换 |
| `${parameter//pattern/string}` | 全部匹配被替换   |
| `${parameter/#pattern/string}` | 字符串开头的替换 |
| `${parameter/%pattern/string}` | 字符串结尾的替换 |

在字符串展开操作中，像**#,%,/,,,^这些符号一旦出现两次**，就代表==**最长或者所有**== 的含义。

如果#，%不是出现在${}中括号内部的开头，那么就表示从字符串首部，尾部开始进行操作。 

如果#出现在${}括号内部的开头，那么就表示获取的是长度的信息。

#### (5)大小写转换

| 表达式                            | 说明                   |
| --------------------------------- | ---------------------- |
| `${parameter,,}`,`${parameter^^}` | 全部转换为小写，大写   |
| `${parameter,}`,`${parameter^}`   | 首字母转换为小写，大写 |

