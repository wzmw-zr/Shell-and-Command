# `awk`的使用—文本数据处理

`awk`是一种文本处理和模式匹配语言，通常被称为**数据驱动的**语言。**程序语句描述需要进行匹配和处理的输入数据。**

**awk命令就是加强版的cut命令与tr命令，那么cut命令就用awk命令代替。**

**awk命令用于处理记录，默认按行处理。**



## 一、`awk`命令常用选项

```sh
awk [-FfV] 'BEGIN{ commands } pattern { command } END{ command }' file
# -F fs：-F选项指定输入分隔符，fs可以是字符串或者正则表达式，awk默认是把空格作为分割符
# -f scriptfile： -f从脚本文件中读取awk命令
# -v var=value:-v 选项用来给变量进行赋值，这个通常使用来将外面的值传递给awk命令

# BEGIN指定在处理数据之前进行的处理操作
# END是指定处理数据结束之后进行的处理操作
# pattern用于指定匹配的数据的模式，后面的command是进行的处理操作
# 不加BEGIN，END,pattern，就是直接处理记录，默认是行匹配，即按行处理
```

使用举例：

```sh
head -n 1 /proc/stat | awk -v sum=0 'for (i=2;i<11;i++){sum=sum+$i} printf("sum=%d;idle=%d",sum,$5)'
```

`awk`的语法可以看作是Shell与C的混合，**数学运算、结构控制、输出都是和C类似的。**

在`awk`中对于记录的字段的指定是**通过`$number`的形式指定记录中的第几个字段。**通过这个就可以实现规整数据的

**==awk中的printf命令中的格式化字符串，参数之间都是以逗号分隔的，即严格的C类型的printf语句==，而Shell中的printf是按照空格分隔的。**

**awk的命令中一定要加上''和{}   !!!**



## 二、`awk`命令的一些常用内建变量

| 变量                   | 描述                                                         |
| ---------------------- | ------------------------------------------------------------ |
| `$n`                   | 当前记录的第n个字段，字段间由FS分隔                          |
| `$0`                   | 完整的输入记录                                               |
| `FILENAME`             | 当前文件名                                                   |
| `FNR`                  | 文件中计数的行号                                             |
| `FS`                   | 字段分隔符，默认是空格                                       |
| `NF`                   | 一条记录的字段数目，这个可以用于将记录的字段当作数组元素处理 |
| `NR`(Number of Record) | 已经读出的记录数，就是行号，从1开始                          |
| `OFS`                  | 输出记录分隔符，默认是换行符                                 |